/* ==========================================================================
   3D Dice - Proper Polyhedra
   Real geometric shapes: d4 tetrahedron, d6 cube, d8 octahedron, etc.
   ========================================================================== */

/* --------------------------------------------------------------------------
   Container Setup
   -------------------------------------------------------------------------- */

.dice-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 24px;
  perspective: 800px;
  min-height: 150px;
  padding: 20px;
}

/* --------------------------------------------------------------------------
   Base 3D Die Wrapper
   -------------------------------------------------------------------------- */

.die-3d {
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.3s ease-out;
}

.die-3d.rolling {
  animation: dice-tumble-3d var(--roll-duration, 1.8s) cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  animation-delay: var(--animation-delay, 0s);
}

.die-shape {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
}

/* Hide result until animation completes */
.die-3d .result-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 32px;
  font-weight: bold;
  color: #fff;
  text-shadow:
    0 0 10px rgba(0,0,0,0.8),
    0 0 20px rgba(233, 69, 96, 0.5),
    2px 2px 4px rgba(0,0,0,0.9);
  opacity: 0;
  z-index: 10;
  pointer-events: none;
  transition: opacity 0.3s ease-out;
}

.die-3d.show-result .result-overlay {
  opacity: 1;
}

/* ==========================================================================
   D4 - TETRAHEDRON (4 triangular faces)
   ========================================================================== */

.die-d4 {
  width: 70px;
  height: 60px;
}

.die-d4 .die-shape {
  transform-style: preserve-3d;
}

.die-d4 .face {
  position: absolute;
  width: 0;
  height: 0;
  border-style: solid;
  opacity: 0.95;
}

/* Tetrahedron faces - pointing up */
.die-d4 .face-1 {
  border-width: 0 35px 60px 35px;
  border-color: transparent transparent #4a1942 transparent;
  transform: translateZ(20px) rotateX(19.5deg);
  left: 0;
  top: 0;
}

.die-d4 .face-2 {
  border-width: 0 35px 60px 35px;
  border-color: transparent transparent #5c2154 transparent;
  transform: rotateY(120deg) translateZ(20px) rotateX(19.5deg);
  left: 0;
  top: 0;
}

.die-d4 .face-3 {
  border-width: 0 35px 60px 35px;
  border-color: transparent transparent #3d1536 transparent;
  transform: rotateY(240deg) translateZ(20px) rotateX(19.5deg);
  left: 0;
  top: 0;
}

.die-d4 .face-4 {
  border-width: 60px 35px 0 35px;
  border-color: #6b2a68 transparent transparent transparent;
  transform: translateY(10px) rotateX(90deg) translateZ(-20px);
  left: 0;
  top: 0;
}

/* ==========================================================================
   D6 - CUBE (6 square faces) with pips
   ========================================================================== */

.die-d6 {
  width: 56px;
  height: 56px;
}

.die-d6 .face {
  position: absolute;
  width: 56px;
  height: 56px;
  background: linear-gradient(145deg, #c41e3a, #8b0000);
  border: 2px solid #ff6b6b;
  border-radius: 8px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  padding: 6px;
  gap: 2px;
  box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
  backface-visibility: hidden;
}

.die-d6 .pip {
  width: 10px;
  height: 10px;
  background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
  border-radius: 50%;
  box-shadow:
    inset -1px -1px 2px rgba(0,0,0,0.3),
    0 1px 2px rgba(0,0,0,0.4);
  justify-self: center;
  align-self: center;
}

/* Face positions */
.die-d6 .face-1 { transform: rotateY(0deg) translateZ(28px); }
.die-d6 .face-6 { transform: rotateY(180deg) translateZ(28px); }
.die-d6 .face-3 { transform: rotateY(90deg) translateZ(28px); }
.die-d6 .face-4 { transform: rotateY(-90deg) translateZ(28px); }
.die-d6 .face-2 { transform: rotateX(90deg) translateZ(28px); }
.die-d6 .face-5 { transform: rotateX(-90deg) translateZ(28px); }

/* Pip positions - using grid area */
.die-d6 .face-1 .pip { grid-area: 2 / 2; }

.die-d6 .face-2 .pip:nth-child(1) { grid-area: 1 / 1; }
.die-d6 .face-2 .pip:nth-child(2) { grid-area: 3 / 3; }

.die-d6 .face-3 .pip:nth-child(1) { grid-area: 1 / 1; }
.die-d6 .face-3 .pip:nth-child(2) { grid-area: 2 / 2; }
.die-d6 .face-3 .pip:nth-child(3) { grid-area: 3 / 3; }

.die-d6 .face-4 .pip:nth-child(1) { grid-area: 1 / 1; }
.die-d6 .face-4 .pip:nth-child(2) { grid-area: 1 / 3; }
.die-d6 .face-4 .pip:nth-child(3) { grid-area: 3 / 1; }
.die-d6 .face-4 .pip:nth-child(4) { grid-area: 3 / 3; }

.die-d6 .face-5 .pip:nth-child(1) { grid-area: 1 / 1; }
.die-d6 .face-5 .pip:nth-child(2) { grid-area: 1 / 3; }
.die-d6 .face-5 .pip:nth-child(3) { grid-area: 2 / 2; }
.die-d6 .face-5 .pip:nth-child(4) { grid-area: 3 / 1; }
.die-d6 .face-5 .pip:nth-child(5) { grid-area: 3 / 3; }

.die-d6 .face-6 .pip:nth-child(1) { grid-area: 1 / 1; }
.die-d6 .face-6 .pip:nth-child(2) { grid-area: 1 / 3; }
.die-d6 .face-6 .pip:nth-child(3) { grid-area: 2 / 1; }
.die-d6 .face-6 .pip:nth-child(4) { grid-area: 2 / 3; }
.die-d6 .face-6 .pip:nth-child(5) { grid-area: 3 / 1; }
.die-d6 .face-6 .pip:nth-child(6) { grid-area: 3 / 3; }

/* ==========================================================================
   D8 - OCTAHEDRON (8 triangular faces)
   ========================================================================== */

.die-d8 {
  width: 50px;
  height: 70px;
}

.die-d8 .face {
  position: absolute;
  width: 0;
  height: 0;
  border-left: 25px solid transparent;
  border-right: 25px solid transparent;
  backface-visibility: hidden;
}

/* Top pyramid (4 faces pointing up) */
.die-d8 .face-1 {
  border-bottom: 35px solid #1b5e20;
  transform: rotateY(0deg) translateZ(18px) rotateX(35deg);
  top: 0; left: 0;
}
.die-d8 .face-2 {
  border-bottom: 35px solid #2e7d32;
  transform: rotateY(90deg) translateZ(18px) rotateX(35deg);
  top: 0; left: 0;
}
.die-d8 .face-3 {
  border-bottom: 35px solid #388e3c;
  transform: rotateY(180deg) translateZ(18px) rotateX(35deg);
  top: 0; left: 0;
}
.die-d8 .face-4 {
  border-bottom: 35px solid #43a047;
  transform: rotateY(270deg) translateZ(18px) rotateX(35deg);
  top: 0; left: 0;
}

/* Bottom pyramid (4 faces pointing down) */
.die-d8 .face-5 {
  border-top: 35px solid #4caf50;
  transform: rotateY(45deg) translateZ(18px) rotateX(-35deg) translateY(35px);
  top: 0; left: 0;
}
.die-d8 .face-6 {
  border-top: 35px solid #66bb6a;
  transform: rotateY(135deg) translateZ(18px) rotateX(-35deg) translateY(35px);
  top: 0; left: 0;
}
.die-d8 .face-7 {
  border-top: 35px solid #81c784;
  transform: rotateY(225deg) translateZ(18px) rotateX(-35deg) translateY(35px);
  top: 0; left: 0;
}
.die-d8 .face-8 {
  border-top: 35px solid #a5d6a7;
  transform: rotateY(315deg) translateZ(18px) rotateX(-35deg) translateY(35px);
  top: 0; left: 0;
}

/* ==========================================================================
   D10 - PENTAGONAL TRAPEZOHEDRON (simplified as bicone)
   ========================================================================== */

.die-d10 {
  width: 50px;
  height: 65px;
}

.die-d10 .face {
  position: absolute;
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
}

/* Top cone faces */
.die-d10 .face-1 { border-bottom: 32px solid #1565c0; transform: rotateY(0deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-2 { border-bottom: 32px solid #1976d2; transform: rotateY(36deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-3 { border-bottom: 32px solid #1e88e5; transform: rotateY(72deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-4 { border-bottom: 32px solid #2196f3; transform: rotateY(108deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-5 { border-bottom: 32px solid #42a5f5; transform: rotateY(144deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-6 { border-bottom: 32px solid #64b5f6; transform: rotateY(180deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-7 { border-bottom: 32px solid #1565c0; transform: rotateY(216deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-8 { border-bottom: 32px solid #1976d2; transform: rotateY(252deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-9 { border-bottom: 32px solid #1e88e5; transform: rotateY(288deg) translateZ(20px) rotateX(25deg); }
.die-d10 .face-10 { border-bottom: 32px solid #2196f3; transform: rotateY(324deg) translateZ(20px) rotateX(25deg); }

/* ==========================================================================
   D12 - DODECAHEDRON (12 pentagonal faces - simplified)
   ========================================================================== */

.die-d12 {
  width: 60px;
  height: 60px;
}

.die-d12 .face {
  position: absolute;
  width: 36px;
  height: 34px;
  background: #ff8f00;
  clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
  backface-visibility: hidden;
  left: 12px;
  top: 13px;
}

/* Arrange 12 pentagons around - approximate positions */
.die-d12 .face-1 { transform: rotateY(0deg) translateZ(28px); background: #ff8f00; }
.die-d12 .face-2 { transform: rotateY(72deg) translateZ(28px); background: #ff9800; }
.die-d12 .face-3 { transform: rotateY(144deg) translateZ(28px); background: #ffa726; }
.die-d12 .face-4 { transform: rotateY(216deg) translateZ(28px); background: #ffb74d; }
.die-d12 .face-5 { transform: rotateY(288deg) translateZ(28px); background: #ffcc80; }
.die-d12 .face-6 { transform: rotateX(90deg) translateZ(28px); background: #ffc107; }
.die-d12 .face-7 { transform: rotateX(-90deg) translateZ(28px); background: #ffd54f; }
.die-d12 .face-8 { transform: rotateX(36deg) rotateY(36deg) translateZ(28px); background: #ff8f00; }
.die-d12 .face-9 { transform: rotateX(36deg) rotateY(108deg) translateZ(28px); background: #ff9800; }
.die-d12 .face-10 { transform: rotateX(-36deg) rotateY(72deg) translateZ(28px); background: #ffa726; }
.die-d12 .face-11 { transform: rotateX(-36deg) rotateY(144deg) translateZ(28px); background: #ffb74d; }
.die-d12 .face-12 { transform: rotateX(36deg) rotateY(180deg) translateZ(28px); background: #ffcc80; }

/* ==========================================================================
   D20 - ICOSAHEDRON (20 triangular faces - simplified)
   ========================================================================== */

.die-d20 {
  width: 60px;
  height: 60px;
}

.die-d20 .face {
  position: absolute;
  width: 0;
  height: 0;
  border-left: 17px solid transparent;
  border-right: 17px solid transparent;
  border-bottom: 30px solid;
  left: 13px;
  top: 15px;
}

/* 20 triangular faces arranged in icosahedron pattern */
.die-d20 .face-1 { border-bottom-color: #0d47a1; transform: rotateY(0deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-2 { border-bottom-color: #1565c0; transform: rotateY(72deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-3 { border-bottom-color: #1976d2; transform: rotateY(144deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-4 { border-bottom-color: #1e88e5; transform: rotateY(216deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-5 { border-bottom-color: #2196f3; transform: rotateY(288deg) translateZ(25px) rotateX(20deg); }

.die-d20 .face-6 { border-bottom-color: #0d47a1; transform: rotateY(36deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-7 { border-bottom-color: #1565c0; transform: rotateY(108deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-8 { border-bottom-color: #1976d2; transform: rotateY(180deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-9 { border-bottom-color: #1e88e5; transform: rotateY(252deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-10 { border-bottom-color: #2196f3; transform: rotateY(324deg) translateZ(25px) rotateX(52deg); }

.die-d20 .face-11 { border-bottom-color: #42a5f5; transform: rotateX(180deg) rotateY(0deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-12 { border-bottom-color: #64b5f6; transform: rotateX(180deg) rotateY(72deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-13 { border-bottom-color: #90caf9; transform: rotateX(180deg) rotateY(144deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-14 { border-bottom-color: #42a5f5; transform: rotateX(180deg) rotateY(216deg) translateZ(25px) rotateX(20deg); }
.die-d20 .face-15 { border-bottom-color: #64b5f6; transform: rotateX(180deg) rotateY(288deg) translateZ(25px) rotateX(20deg); }

.die-d20 .face-16 { border-bottom-color: #90caf9; transform: rotateX(180deg) rotateY(36deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-17 { border-bottom-color: #bbdefb; transform: rotateX(180deg) rotateY(108deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-18 { border-bottom-color: #90caf9; transform: rotateX(180deg) rotateY(180deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-19 { border-bottom-color: #bbdefb; transform: rotateX(180deg) rotateY(252deg) translateZ(25px) rotateX(52deg); }
.die-d20 .face-20 { border-bottom-color: #e3f2fd; transform: rotateX(180deg) rotateY(324deg) translateZ(25px) rotateX(52deg); }

/* ==========================================================================
   D100 - Two D10s or special percentile die
   ========================================================================== */

.die-d100 {
  width: 55px;
  height: 70px;
}

.die-d100 .face {
  position: absolute;
  width: 0;
  height: 0;
  border-left: 16px solid transparent;
  border-right: 16px solid transparent;
}

/* Similar to d10 but gold colored */
.die-d100 .face-1 { border-bottom: 35px solid #6d4c41; transform: rotateY(0deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-2 { border-bottom: 35px solid #795548; transform: rotateY(36deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-3 { border-bottom: 35px solid #8d6e63; transform: rotateY(72deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-4 { border-bottom: 35px solid #a1887f; transform: rotateY(108deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-5 { border-bottom: 35px solid #6d4c41; transform: rotateY(144deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-6 { border-bottom: 35px solid #795548; transform: rotateY(180deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-7 { border-bottom: 35px solid #8d6e63; transform: rotateY(216deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-8 { border-bottom: 35px solid #a1887f; transform: rotateY(252deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-9 { border-bottom: 35px solid #6d4c41; transform: rotateY(288deg) translateZ(22px) rotateX(25deg); }
.die-d100 .face-10 { border-bottom: 35px solid #795548; transform: rotateY(324deg) translateZ(22px) rotateX(25deg); }

/* ==========================================================================
   D4 special (fallback simple shape)
   ========================================================================== */

.die-d4-simple {
  width: 60px;
  height: 52px;
}

.die-d4-simple .die-shape {
  width: 0;
  height: 0;
  border-left: 30px solid transparent;
  border-right: 30px solid transparent;
  border-bottom: 52px solid #7b1fa2;
  position: relative;
}

.die-d4-simple .die-shape::after {
  content: '';
  position: absolute;
  width: 0;
  height: 0;
  border-left: 30px solid transparent;
  border-right: 30px solid transparent;
  border-bottom: 52px solid #9c27b0;
  top: 0;
  left: -30px;
  transform: rotateY(180deg);
  opacity: 0.8;
}

/* ==========================================================================
   Tumbling Animation
   ========================================================================== */

@keyframes dice-tumble-3d {
  0% {
    transform: translateY(-150px) translateZ(50px)
               rotateX(0deg) rotateY(0deg) rotateZ(0deg)
               scale(0.5);
    opacity: 0;
  }
  5% {
    opacity: 1;
    transform: translateY(-120px) translateZ(40px)
               rotateX(45deg) rotateY(30deg) rotateZ(15deg)
               scale(0.7);
  }
  20% {
    transform: translateY(-60px) translateZ(30px)
               rotateX(180deg) rotateY(120deg) rotateZ(60deg)
               scale(0.9);
  }
  40% {
    transform: translateY(-10px) translateZ(15px)
               rotateX(360deg) rotateY(240deg) rotateZ(120deg)
               scale(1);
  }
  55% {
    transform: translateY(5px) translateZ(5px)
               rotateX(450deg) rotateY(300deg) rotateZ(150deg)
               scale(1);
  }
  70% {
    transform: translateY(-3px) translateZ(2px)
               rotateX(520deg) rotateY(340deg) rotateZ(170deg)
               scale(1);
  }
  85% {
    transform: translateY(2px) translateZ(0px)
               rotateX(560deg) rotateY(355deg) rotateZ(178deg)
               scale(1);
  }
  100% {
    transform: translateY(0) translateZ(0)
               rotateX(var(--end-rx, 0deg))
               rotateY(var(--end-ry, 0deg))
               rotateZ(var(--end-rz, 0deg))
               scale(1);
    opacity: 1;
  }
}

/* Landing bounce */
@keyframes dice-land {
  0% { transform: translateY(0); }
  30% { transform: translateY(-8px); }
  60% { transform: translateY(0); }
  80% { transform: translateY(-3px); }
  100% { transform: translateY(0); }
}

.die-3d.landed {
  animation: dice-land 0.4s ease-out;
}

/* ==========================================================================
   Result States
   ========================================================================== */

.die-3d.dropped {
  opacity: 0.4;
  filter: grayscale(80%);
  transform: scale(0.85);
}

.die-3d.nat20 {
  filter: drop-shadow(0 0 15px #4ade80) drop-shadow(0 0 30px #22c55e);
}

.die-3d.nat20 .result-overlay {
  color: #4ade80;
  text-shadow:
    0 0 10px #4ade80,
    0 0 20px #22c55e,
    0 0 30px #16a34a;
}

.die-3d.nat1 {
  filter: drop-shadow(0 0 15px #f87171) drop-shadow(0 0 30px #ef4444);
}

.die-3d.nat1 .result-overlay {
  color: #f87171;
  text-shadow:
    0 0 10px #f87171,
    0 0 20px #ef4444,
    0 0 30px #dc2626;
}

/* Crit pulse animation */
@keyframes crit-glow {
  0%, 100% { filter: drop-shadow(0 0 15px currentColor) brightness(1); }
  50% { filter: drop-shadow(0 0 25px currentColor) brightness(1.2); }
}

.die-3d.nat20,
.die-3d.nat1 {
  animation: crit-glow 1.5s ease-in-out infinite;
}

/* ==========================================================================
   Reduced Motion
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  .die-3d.rolling {
    animation: none;
  }

  .die-3d.nat20,
  .die-3d.nat1 {
    animation: none;
  }
}

/* ==========================================================================
   Mobile Responsive
   ========================================================================== */

@media (max-width: 768px) {
  .dice-container {
    gap: 16px;
    perspective: 500px;
    min-height: 120px;
  }

  .die-d4 { width: 55px; height: 48px; }
  .die-d6 { width: 46px; height: 46px; }
  .die-d8 { width: 42px; height: 58px; }
  .die-d10 { width: 42px; height: 55px; }
  .die-d12 { width: 50px; height: 50px; }
  .die-d20 { width: 50px; height: 50px; }
  .die-d100 { width: 46px; height: 58px; }

  .die-d6 .face {
    width: 46px;
    height: 46px;
  }

  .die-d6 .face-1 { transform: rotateY(0deg) translateZ(23px); }
  .die-d6 .face-6 { transform: rotateY(180deg) translateZ(23px); }
  .die-d6 .face-3 { transform: rotateY(90deg) translateZ(23px); }
  .die-d6 .face-4 { transform: rotateY(-90deg) translateZ(23px); }
  .die-d6 .face-2 { transform: rotateX(90deg) translateZ(23px); }
  .die-d6 .face-5 { transform: rotateX(-90deg) translateZ(23px); }

  .die-d6 .pip {
    width: 8px;
    height: 8px;
  }

  .die-3d .result-overlay {
    font-size: 26px;
  }
}
